<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">
<head>
    <title>차량 대여</title>
</head>
<!-- Content -->
<main layout:fragment="content" class="container mt-4">
    <h1 class="display-5">대여 날짜</h1>
    <div th:text="${month} + '월'"></div>
    <!-- 캘린더 프래그먼트 -->
    <div th:replace="~{fragments/calendar :: commonCalendar(${header}, ${dateArr})}"></div>

    <script>
        let pickupDay = null;
        let returnDay = null;
        let pickupMonth = [[${month}]];
        let pickupYear = [[${year}]];
        let returnMonth = [[${month}]];
        let returnYear = [[${year}]];

        function selectDate(element) {
            const day = element.getAttribute('data-day');
            console.log(day);
            if (pickupDay == null) {
                pickupDay = day;
                element.classList.add('bg-dark');
            } else if (returnDay == null) {
                returnDay = day;
                element.classList.add('bg-dark');
            } else {
                alert('날짜를 다시 선택해주세요.');
                window.location.reload();
                return;
            }
            if (pickupDay != null && returnDay != null) {
                if ([[${today}]] > pickupDay) {
                    pickupMonth = pickupMonth + 1;
                    if (pickupMonth > 12) {
                        pickupMonth = 1;
                        pickupYear = pickupYear + 1;
                    }
                }
                if ([[${today}]] > returnDay) {
                    returnMonth = returnMonth + 1;
                    if (returnMonth > 12) {
                        returnMonth = 1;
                        returnYear = returnYear + 1;
                    }
                }
                console.log(pickupYear + '-' + pickupMonth + '-' + pickupDay);
                console.log(returnYear + '-' + returnMonth + '-' + returnDay);
                fetch('/car/rental', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        carId: [[${carId}]],
                        pickupDate: pickupYear + '-' + pickupMonth + '-' + pickupDay,
                        returnDate: returnYear + '-' + returnMonth + '-' + returnDay
                    })
                }).then(response => {
                    if (response.ok) {
                        alert('차량 대여 신청이 완료되었습니다.');
                        window.location.href = '/car/rental';
                    } else {
                        alert('차량 대여 신청에 실패하였습니다.');
                        window.location.reload();
                    }
                });
            }
        }
    </script>
</main>
</html>